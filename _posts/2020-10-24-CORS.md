## 서론

웹 개발을 하다보면 CORS 정책을 위반하여 에러가 자주 발생합니다.ㅠㅠ CORS 정책의 개념에 대한 이해가 부족하다면 이를 해결하기 위해 골머리를 앓아야 할지도 모릅니다. CORS 정책의 개념과 필요성에 대해 정리해 보았습니다.



## SOP?

왜 갑자기 SOP냐고 물으실 수 있지만 CORS 정책을 알기 위해 SOP를 알아야 합니다. 

**SOP(Same-Origin Policy)**는 동일 출처로 요청(Same-Origin Request)하지 않으면 허용하지 않겠다는 정책입니다. 그러나 **Cross-site HTTP Request**의 필요성이 증가함에 따라 **CORS**라는 이름으로 새로운 표준이 나왔습니다.

## CORS란?

 `XMLHttpRequest`가 `cross-domain HTTP Request`를 할 수 있도록 만든 정책입니다. 웹 어플리케이션이 다른 오리진 서버로의 액세스를 허가할 수 있도록 하는 것입니다.

서버에서 응답 헤더에 도메인을 추가하여 허가할 수 있습니다.

**CORS(Cross-Origin Resource Sharing)** 정책이 웹 개발자에게 귀찮을 수 있지만, 사실 CORS가 존재하기 때문에 오히려 번거로움이 줄어듭니다. 하나하나 알아가 봅시다! ㅎ_ㅎ



## 출처(Origin)???

`https://google.com`과 같은 URL은 아래와 같은 구성을 가집니다.

<img width="479" alt="1" src="https://user-images.githubusercontent.com/41600558/97080426-1a497980-1636-11eb-8169-6c6e7ddf25bc.png">

**Origin**은 `Protocol`과 `Host`, 그리고 위 그림에는 없지만 `:80`과 같은 포트 번호를 결합한 것을 의미합니다. 즉, **서버의 위치를 찾아가기 위해 필요한 가장 기본적인 것들을 합쳐놓은 것**입니다.

`HTTP`, `HTTPS` 와 같은 프로토콜은 기본 포트가 정해져 있기 때문에 Origin에 포트번호를 생략할 수 있습니다.

만약, `https://google.com:443`과 같이 출처에 포트 번호가 명시적으로 포함되어 있다면 이 포트 번호까지 모두 일치해야 같은 출처라고 인정됩니다.

브라우저의 개발자 도구 콘솔에서 아래와 같은 명령어를 통해 `Location` 객체가 가지고 있는 `origin`프로퍼티를 확인할 수 있습니다.

```javascript
console.log(location.origin);
```



## 왜 CORS가 필요한가요?

다른 두 개의 어플리케이션이 마음대로 소통할 수 있는 환경은 꽤 위험합니다.

이를 제약하지 않는다면, 악의를 가진 사용자가 **CSRF(Cross-Site Request Forgery)**나 **XSS(Crose-Site Scripting)**와 같은 방법으로 공격하기 쉬워집니다. 이를 방지하기 위해 개발자가 신경써야 할 부분은 많아질 것입니다.



## 같은 출처? 다른 출처?

그럼 같은 출처와 다른 출처는 어떻게 구별하는 것일까요? 사실 이것은 매우 간단한데, 두 URL의 구성 요소중 `Scheme`, `Host`, `Port` 이 3가지만 동일하면 됩니다.

`https://ungdoong.github.io:80`을 예로들면, `https://`라는 `Scheme`에 `ungdoong.github.io`라는 호스트를 가지고 `:80` 포트를 사용하고 있으면 나머지가 다르더라도 같은 출처로 인정됩니다. 

즉, `https://ungdoong.github.io`와  `https://ungdoong.github.io/about`는 같은 출처이고 `http://ungdoong.github.io/about`는 `Scheme`이 다르므로 다른 출처입니다.

> `https://ungdoong.github.io:8000` 과 같은 경우는 브라우저에 따라 달라질 수 있습니다.
>
> 출처 비교시 포트 번호를 완전 무시하는 브라우저는 Internet Explorer 밖에 없습니다. (개노답^^)



## Preflight Request