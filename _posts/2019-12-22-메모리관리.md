# 191222(Sun)\_메모리관리

## 메모리 추상화: 주소공간

_______________

### 프로세스가 물리 메모리를 직접 사용하는 것의 단점

- 프로그램이 물리 메모리의 모든 주소를 접근할 수 있다면 사용자에 의해 운영체제가 파괴될 수 있음
- 여러 프로그램들을 동시에 실행시키는 것이 어려워짐

### 주소 공간 개념

여러 프로그램들을 동시에 메모리에 적재하고 서로 간섭 없이 실행하기 위해서는 보호(protection)와 재배치(relocation) 방법이 제공되어야 함

- 주소 공간(address space)이라는 새로운 메모리 추상화를 사용

### Base와 Limit 레지스터

base와 limit라는 이름의 특별한 하드웨어 레지스터 사용

- 각 프로세스의 주소공간을 물리 메모리의 서로 다른 공간으로 연속으로 매핑
- base 레지스터 - 프로그램이 적재된 메모리 시작위치
- limit 레지스터 - 프로그램의 크기
- 프로세스가 참조하려는 메모리 주소에 base 레지스터 값을 더하고 그 주소가 limit 레지스터 값 미만인지 확인
- 단점
  - 모든 메모리 참조마다 덧셈과 비교연산이 요구됨
  - 물리 메모리 용량이 모든 프로세스를 적재할 만큼 충분히 많은 경우 사용

### 스와핑(swapping)

한 프로세스의 모든 이미지가 메모리로 적재되어 실행되다가 더 이상 실행되지 않을 경우 다시 디스크로 내려 보내는 방법

- 주기적으로 깨어나 실행하고 다시 수면에 빠지는 프로세스들은 메모리의 상태에 따라 계속 메모리에 존재할 수도 있고 디스크로 내려갈 수도 있음
- 메모리 조각모음(memory compaction) 필요
- 동적 할당시 메모리 공간 문제 존재(Heap 영역)

### 가용 메모리 공간 관리

- 비트맵을 이용한 관리
  - 각 할당 단위마다 비트가 하나씩 대응
  - 할당 단위가 작아질수록 비트맵 공간이 커짐
  - 프로세스의 크기가 할당 단위의 정수배가 아니면 마지막 할단 단위의 일부 공간이 낭비
  - 프로세스가 k개의 할당 단위를 요구했을 때 메모리 관리자가 비트맵에서 연속적인 k개의 0비트를 찾아야 해서 시간이 많이 걸림

- 연결 리스트를 이용한 관리

  - 할당된 메모리 공간과 가용한 메모리 공간을 연결 리스트로 관리

  - 각 엔트리들을 시작 주소를 키로 정렬하면

    - 프로세스가 종료되거나 스왑 아웃될 때 리스트의 관리를 쉽게 함

    - 스왑 인에 다양한 알고리즘 적용 가능
    - 최초적합(first fit)
    - 다음적합(next fit) - 지난 번 할당 때 기억해준 위치부터 검색 시작
    - 최적적합(best fit) - 모든 엔트리들을 검색하여 요청한 크기에 가장 근접하게 큰 빈 공간 할당
      - 최초적합에 비해 느림
    - 최악적합(worst fit) - 가능한 프로세스가 요구하는 크기에 맞도록 빈 공간을 할당하면 작은 빈 공간들이 많이 생성되므로 항상 가장 큰 빈 공간을 할당함
    - 빠른적합

## 

## 주소 바인딩

________________

### 컴파일 시점 주소 바인딩

컴파일 될 때 컴파일러에서 명령어들과 변수의 메모리 주소가 정해지는 것

- 프로그램을 다른 시스템에서 실행하였을 때 해당 시스템의 Starting Point가 다를 수 있음
- 이미 주소에 다른 프로그램이 실행중일 수 있음
  - 실행 불가
- 컴파일 후 메모리에 로드 되기전 Logical 주소는 Physical 주소와 같음

### 로드 시점 주소 바인딩

메모리에 올라갈 때 CPU에서 주소 계산이 일어난 후 발생하는 주소

- CPU에서 주소를 계산할 때 Base 레지스터 값을 더하여 주소 생성
- CPU 내에서 계산되고 발생한 Logical 주소는 Physical 주소와 같음

### 실행 시점 주소 바인딩

메모리에 올라가 매번 명령어가 실행될 때마다 주소가 계산됨

프로그램의 메모리 위치가 매번 바뀔 때 사용

- CPU에서 나온 임의의 주소는 MMU라는 곳을 거쳐 실제 주소로 바뀌어 접근
- CPU에서 발생한 주소가 Logical 주소이고 MMU를 거친 후의 주소가 Physical 주소. 서로 다름